<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Albert Y. Kim" />

<meta name="date" content="2015-10-23" />

<title>SpatialEpi: Data and Methods for Spatial Epidemiology</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title"><code>SpatialEpi</code>: Data and Methods for Spatial Epidemiology</h1>
<h4 class="author"><em>Albert Y. Kim</em></h4>
<h4 class="date"><em>2015-10-23</em></h4>
</div>


<div id="setting-up-your-machine" class="section level2">
<h2>Setting Up Your Machine</h2>
<p>The next steps will enable your computer to read in ESRI shapefiles. Fortunately you only have to do this once:</p>
<div id="mac-users" class="section level3">
<h3>Mac Users</h3>
<ul>
<li>Install either Xcode (available for free in the App Store) or the <a href="https://developer.apple.com/downloads/">Command Line Tools for Xcode</a>. You’ll need to have a (free) Apple ID.</li>
<li>In your Mac menu bar go to System Preferences… -&gt; Security &amp; Privacy -&gt; unlock the lock on the bottom left of panel -&gt; select “Allow apps downloaded from”: Anywhere -&gt; relock the lock</li>
<li>Open Terminal by going to a Finder window -&gt; Applications -&gt; Utilities -&gt; Terminal. You open new tabs in Terminal by pressing command+T.</li>
<li>In Terminal
<ul>
<li>Run <code>sudo xcodebuild -license</code>, scroll to the bottom and type <code>agree</code> to agree to the licence.</li>
<li>Open a new tab and run <code>xcode-select --install</code></li>
</ul></li>
<li>Install Macports as per the <a href="http://www.macports.org/install.php">Quickstart</a> instructions.
<ul>
<li>You have already completed steps 1 and 2.</li>
<li>To know what version of OS X you have click on the Apple icon on the top left of the menu bar -&gt; About This Mac</li>
</ul></li>
<li>Install the <a href="http://www.gdal.org/"><code>gdal</code></a> and <a href="http://trac.osgeo.org/geos/"><code>geos</code></a> geospatial libraries.
<ul>
<li>In Terminal open a new tab and run <code>sudo port install gdal</code></li>
<li>In Terminal open a new tab and run <code>sudo port install geos</code></li>
</ul></li>
<li>Install the <code>rgdal</code> package to interface the <code>gdal</code> geospatial library with R
<ul>
<li>Under <a href="https://cran.r-project.org/web/packages/rgdal/index.html">Downloads</a> select “Package Source”. It should be named <code>rgdal_X.Y-Z.tar.gz</code> where <code>X,Y,Z</code> denote the version number.</li>
<li>In Terminal open a new tab and run <code>R CMD INSTALL ~/Downloads/rgdal_X.Y-Z.tar.gz</code> where <code>X,Y,Z</code> are changed to match the name of the file you just downloaded</li>
</ul></li>
<li>Install the <code>rgeos</code> package to interface the <code>geos</code> geospatial library with R
<ul>
<li>Under <a href="https://cran.r-project.org/web/packages/rgeos/index.html">Downloads</a> select “Package Source”. It should be named <code>rgeos_X.Y-Z.tar.gz</code> where <code>X,Y,Z</code> denote the version number.</li>
<li>In Terminal open a new tab and run <code>R CMD INSTALL ~/Downloads/rgeos_X.Y-Z.tar.gz</code> where <code>X,Y,Z</code> are changed to match the name of the file you just downloaded</li>
</ul></li>
</ul>
</div>
<div id="windows-users" class="section level3">
<h3>Windows Users</h3>
<ul>
<li>Follow the instructions in <a href="http://trac.osgeo.org/osgeo4w/">Quick Start for OSGeo4W Users</a></li>
<li>In R, run <code>install.packages(&quot;rgeos&quot;, repos=&quot;http://R-Forge.R-project.org&quot;, type=&quot;source&quot;)</code></li>
</ul>
</div>
<div id="linux-users" class="section level3">
<h3>Linux Users</h3>
<p>I’m going to assume you know what you’re doing!</p>
</div>
<div id="all-users" class="section level3">
<h3>All Users</h3>
<p>Test that both the <code>rgdal</code> and <code>rgeos</code> packages are installed by running</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgdal)
<span class="kw">library</span>(rgeos)</code></pre>
</div>
</div>
<div id="north-carolina-sids-data" class="section level2">
<h2>North Carolina SIDS Data</h2>
<p>The <code>nc.sids</code> data frame has 100 rows and 21 columns and can be found in the <code>spdep</code> package. It contains data given in Cressie (1991, pp. 386-9), Cressie and Read (1985) and Cressie and Chan (1989) on sudden infant deaths in North Carolina for 1974–78 and 1979–84. The data set also contains the neighbour list given by Cressie and Chan (1989) omitting self-neighbours (<code>ncCC89.nb</code>), and the neighbour list given by Cressie and Read (1985) for contiguities (<code>ncCR85.nb</code>). Data is available on the numbers of cases and on the number of births, both dichotomized by a binary indicator of race. The data are ordered by county ID number, not alphabetically as in the source tables.</p>
<p>The code below plots the county boundaries along with the observed SMRs. The expected numbers are based on internal standardization with a single stratum.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spdep)
<span class="kw">data</span>(nc.sids)

<span class="kw">library</span>(rgdal)
shapefile_dir &lt;-<span class="st"> &quot;/Library/Frameworks/R.framework/Versions/3.2/Resources/library/spdep/etc/shapes/&quot;</span>
nc_sids &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> shapefile_dir, <span class="dt">layer =</span> <span class="st">&quot;sids&quot;</span>, 
    <span class="dt">p4s =</span> <span class="st">&quot;+proj=longlat +ellps=clrk66&quot;</span>, 
    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)

<span class="co"># Read in shapefile</span>
<span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">library</span>(maptools)
shapefile_name &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;etc/shapes/sids.shp&quot;</span>, 
    <span class="dt">package =</span> <span class="st">&quot;spdep&quot;</span>)
shapefile_name &lt;-<span class="st"> &quot;/Library/Frameworks/R.framework/Versions/3.2/Resources/library/spdep/etc/shapes/sids.shp&quot;</span>
nc_sids &lt;-<span class="st"> </span><span class="kw">readShapePoly</span>(<span class="dt">fn =</span> shapefile_name, 
    <span class="dt">ID =</span> <span class="st">&quot;FIPSNO&quot;</span>, <span class="dt">proj4string =</span> <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=clrk66&quot;</span>))</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
